@model IEnumerable<PMS.Domains.ProjectMessage>

@using Microsoft.AspNetCore.Http
@using PMS.Features.UserManagement.Services
@inject IHttpContextAccessor HttpContextAccessor

@{
    var projectName = HttpContextAccessor.HttpContext?.Session.GetString("selectedProjectName");
    var empDetail = HttpContextAccessor.HttpContext?.Session.GetObject<PMS.Domains.Employee>("employee");

    var name = empDetail?.Name ?? "Super Admin";
    var colorHex = GetProjectColor(name);
    var textColor = GetTextColor(colorHex);
    var colorHexForUrl = colorHex.Replace("#", "");
}

@functions {
    // Generate a consistent color from project name
    string GetProjectColor(string input)
    {
        int hash = input.GetHashCode();
        byte r = (byte)((hash & 0xFF0000) >> 16);
        byte g = (byte)((hash & 0x00FF00) >> 8);
        byte b = (byte)(hash & 0x0000FF);

        // Brighten color
        r = (byte)((r + 200) / 2);
        g = (byte)((g + 200) / 2);
        b = (byte)((b + 200) / 2);

        return $"#{r:X2}{g:X2}{b:X2}";
    }

    // Determine text color (black or white) based on background brightness
    string GetTextColor(string hex)
    {
        hex = hex.Replace("#", "");
        int r = Convert.ToInt32(hex.Substring(0, 2), 16);
        int g = Convert.ToInt32(hex.Substring(2, 2), 16);
        int b = Convert.ToInt32(hex.Substring(4, 2), 16);
        int brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness > 160 ? "#000000" : "#FFFFFF"; // black if bright, else white
    }

}

<li class="dropdown messages-menu">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
        <i class="fa fa-envelope-o"></i>
        <span class="label label-success">@Model.Count()</span>
    </a>
    <ul class="dropdown-menu">
        <li class="header">You have @Model.Count() messages</li>
        <li>
            <ul class="menu">
                @foreach (var data in Model)
                {
                    var diff = DateTime.Now - data.CreatedDate;
                    string timeAgo;

                    if (diff.TotalSeconds < 60)
                        timeAgo = $"{diff.Seconds} seconds ago";
                    else if (diff.TotalMinutes < 60)
                        timeAgo = $"{diff.Minutes} minutes ago";
                    else if (diff.TotalHours < 24)
                        timeAgo = $"{diff.Hours} hours ago";
                    else if (diff.TotalDays < 30)
                        timeAgo = $"{diff.Days} days ago";
                    else if (diff.TotalDays < 365)
                        timeAgo = $"{(int)(diff.TotalDays / 30)} months ago";
                    else
                        timeAgo = $"{(int)(diff.TotalDays / 365)} years ago";

                    <li>
                        <a href="#">
                            <div class="pull-left">
                                <img src="https://ui-avatars.com/api/?name=@data.FromMessage&size=400&background=@colorHexForUrl&color=fff" class="img-circle" alt="User Image" />
                            </div>
                            <h4>
                                @data.FromMessage
                                <small><i class="fa fa-clock-o"></i>@timeAgo</small>
                            </h4>
                            <p>@data.MessageInfo</p>
                        </a>
                    </li>
                }
            </ul>
        </li>
        <li class="footer"><a href="#">See All Messages</a></li>
    </ul>
</li>







