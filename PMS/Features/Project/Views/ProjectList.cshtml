@model IEnumerable<PMS.Features.Project.ViewModels.ProjectViewModel>

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-body">
				<table id="documentTable" class="table table-bordered table-striped">
					<thead>
						<tr>
							<th>Name</th>
							<th>Head</th>
							<th>Head</th>
							<th>Manager</th>
							<th>Start Date </th>
							<th>End Date</th>
							<th>Action</th>
							<th>Status</th>
							
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model)
						{
							<tr>
								<td>
									<a asp-controller="Project" asp-action="GetProjectDetail" asp-route-id="@item.Id">@item.Name</a>
								</td>
								<td>@item.ProjectHead</td>
								<td>@item.DeliveryHead</td>
								<td>@item.ProjectManager</td>
								<td>@item.ProjectStartDate?.ToString("yyyy-MM-dd")</td>
								<td>@item.ProjectEndDate?.ToString("yyyy-MM-dd")</td>

								<td>
									<a asp-action="Index" asp-route-id="@item.Id" asp-controller="Project" class="btn btn-success" title="Edit">
										<i class="fa fa-edit"></i>
									</a>
									<a href="#" class="btn btn-danger" title="Delete" onclick="confirmDelete('@item.Id')">
										<i class="fa fa-trash"></i>
									</a>

								</td>
								<td>
									<select class="form-control" asp-for="@item.ProjectStatus" id="ddlProjectStatus" onchange="ddlProjectStatusChanges(this,'@item.Id','@item.Name')">
										<option>--select--</option>
										<option value="Started">Started</option>
										<option value="Client Discussion">Discussion</option>
										<option value="Client Finalized">Client Finalized</option>
										<option value="In Progress">In Progress</option>
										<option value="OnHold">On Hold</option>
										<option value="Completed">Completed</option>
									</select>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>


<!-- Reason Modal -->
<div class="modal fade" id="reasonModal" tabindex="-1" aria-labelledby="reasonModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-md">
		<div class="modal-content rounded shadow-sm">
			<div class="modal-header bg-primary text-white py-2">
				<h5 class="modal-title" id="reasonModalLabel">Enter more information regarding status changes. </h5>

			</div>
			<div class="modal-body">
				<label> Please provide a reason for changing the status of this project. <br/>
								Your input helps us maintain accurate project records and ensures transparency for all stakeholders.</label>
				<textarea id="reasonText" class="form-control" rows="4" placeholder="Enter some more information..."></textarea>
			</div>
			<div class="modal-footer py-2">
				<button type="button" class="btn btn-secondary btn-sm" onclick="closeReasonModal()" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary btn-sm" onclick="submitReason()">Submit</button>
			</div>
		</div>
	</div>
</div>


<script>

	var projectId=0
	var status=''

	$(document).ready(function () {
		$('#documentTable').DataTable({
			"paging": true,
			"lengthChange": true,
			"searching": true,
			"ordering": true,
			"info": true,
			"autoWidth": false,
			"responsive": true,
			"scrollY": "450px",
		   "scrollCollapse": true
		});
	});

	function ddlProjectStatusChanges(selectElement, id, name) {
			var value = $(selectElement).val();
			status= value;
			$("#reasonModalLabel").text('Enter more information on ('+ name+')')
			$("#reasonModal").modal('show');
			projectId= id;
	}

	function closeReasonModal(){
			$("#reasonModal").modal('hide')
			$("#reasonText").val('')
	}

	function submitReason(){
		var reason= $("#reasonText").val();
		$.get("/Project/UpdateProjectStatus",{ id:projectId, reason,status }, function(resp){
		toastr.success("Project status updated !");
				hideLoader();
				closeReasonModal();
		})
	}

	function confirmDelete(id) {
		confirmAction({
			title: 'Delete Record',
			text: 'Are you sure you want to delete this records?',
			confirmText: 'Yes, delete it!',
			cancelText: 'No, keep it'
		}).then((result) => {
			if (result.isConfirmed) {
				$.get('/Features/Project/DeleteProject', {id:id},function(resp){
					toastr.success("Deleted successfully!");
					fn_ProjectList();
					hideLoader();
				});
			}
		});
	}
</script>





