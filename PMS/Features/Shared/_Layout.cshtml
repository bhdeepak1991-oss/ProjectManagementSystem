@using PMS.Features.UserManagement.Services

@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
	var projectName = HttpContextAccessor.HttpContext?.Session.GetString("selectedProjectName");
	var empDetail = HttpContextAccessor.HttpContext?.Session.GetObject<PMS.Domains.Employee>("employee");

	var name = empDetail?.Name ?? "Super Admin";
	var colorHex = GetProjectColor(name);
	var textColor = GetTextColor(colorHex);
	var colorHexForUrl = colorHex.Replace("#", "");
}

@functions {
	// Generate a consistent color from project name
	string GetProjectColor(string input)
	{
		int hash = input.GetHashCode();
		byte r = (byte)((hash & 0xFF0000) >> 16);
		byte g = (byte)((hash & 0x00FF00) >> 8);
		byte b = (byte)(hash & 0x0000FF);

		// Brighten color
		r = (byte)((r + 200) / 2);
		g = (byte)((g + 200) / 2);
		b = (byte)((b + 200) / 2);

		return $"#{r:X2}{g:X2}{b:X2}";
	}

	// Determine text color (black or white) based on background brightness
	string GetTextColor(string hex)
	{
		hex = hex.Replace("#", "");
		int r = Convert.ToInt32(hex.Substring(0, 2), 16);
		int g = Convert.ToInt32(hex.Substring(2, 2), 16);
		int b = Convert.ToInt32(hex.Substring(4, 2), 16);
		int brightness = (r * 299 + g * 587 + b * 114) / 1000;
		return brightness > 160 ? "#000000" : "#FFFFFF"; // black if bright, else white
	}

}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Vipra | PMS</title>
	<meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
	<link href="~/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="http://code.ionicframework.com/ionicons/2.0.0/css/ionicons.min.css" rel="stylesheet" type="text/css" />
	<link href="plugins/morris/morris.css" rel="stylesheet" type="text/css" />
	<link href="~/plugins/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
	<link href="~/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
	<link href="~/dist/css/AdminLTE.min.css" rel="stylesheet" type="text/css" />
	<link href="~/dist/css/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />

	<style>
		.content-header {
			display: flex;
			align-items: center; /* vertical alignment */
			justify-content: space-between; /* spread left and right */
		}

			.content-header h1 {
				margin: 0; /* remove default heading margin */
			}
		/* Slide in from left */
		.modal.modal-left .modal-dialog {
			position: fixed;
			margin: 0;
			left: 0;
			top: 0;
			bottom: 0;
			height: 100%;
			transform: translateX(-100%);
			transition: transform 0.3s ease-out;
			width: 400px; /* Adjust width as needed */
		}

		.modal.modal-left.show .modal-dialog {
			transform: translateX(0);
		}

		.modal.modal-left .modal-content {
			height: 100%;
			border: none;
			border-radius: 0;
		}

		/* Optional full screen backdrop */
		.modal-backdrop.show {
			opacity: 0.5;
		}

		.toast-middle-center {
			top: 50% !important;
			left: 50% !important;
			transform: translate(-50%, -50%);
			position: fixed;
			z-index: 9999;
		}
	</style>

	<style>
		/* Fullscreen blurred overlay */
		#loader-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: none;
			align-items: center;
			justify-content: center;
			backdrop-filter: blur(6px);
			background-color: rgba(0, 0, 0, 0.5); /* Dark transparent background */
			z-index: 9999;
		}

		/* Centered loader content */
		.loader-content {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		/* Custom colored spinner */
		.spinner {
			width: 70px;
			height: 70px;
			border: 8px solid rgba(255, 255, 255, 0.2);
			border-top: 8px solid #4caf50; /* 💡 Customize this color */
			border-radius: 50%;
			animation: spin 1s linear infinite;
		}

		/* Spinner animation */
		@@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		.input-validation-error {
			border: 1px solid #dc3545; /* Bootstrap red */
			background-color: #fff5f5; /* optional light red background */
			color: #212529;
		}

			.input-validation-error:focus {
				outline: none;
				box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25); /* subtle red shadow */
			}

		body{
			font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
		}
		p{
			font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
		}
	</style>

</head>
<body class="skin-blue">
	<div class="wrapper">

		<header class="main-header">
			<!-- Logo -->
			<a asp-action="Index" asp-controller="Dashboard" class="logo"><b>@projectName</b></a>
			<!-- Header Navbar: style can be found in header.less -->
			<nav class="navbar navbar-static-top" role="navigation">
				<!-- Sidebar toggle button-->
				<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
					<span class="sr-only">Toggle navigation</span>
				</a>
				<!-- Navbar Right Menu -->
				<div class="navbar-custom-menu">
					<ul class="nav navbar-nav">
						<!-- Messages: style can be found in dropdown.less-->
						<li class="dropdown messages-menu">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-envelope-o"></i>
								<span class="label label-success">4</span>
							</a>
							<ul class="dropdown-menu">
								<li class="header">You have 4 messages</li>
								<li>
									<!-- inner menu: contains the actual data -->
									<ul class="menu">
										<li>
											<!-- start message -->
											<a href="#">
												<div class="pull-left">
													<img src="#" class="img-circle" alt="User Image" />
												</div>
												<h4>
													Support Team
													<small><i class="fa fa-clock-o"></i> 5 mins</small>
												</h4>
												<p>Why not buy a new awesome theme?</p>
											</a>
										</li><!-- end message -->
										<li>
											<a href="#">
												<div class="pull-left">
													<img src="#" class="img-circle" alt="user image" />
												</div>
												<h4>
													AdminLTE Design Team
													<small><i class="fa fa-clock-o"></i> 2 hours</small>
												</h4>
												<p>Why not buy a new awesome theme?</p>
											</a>
										</li>
										<li>
											<a href="#">
												<div class="pull-left">
													<img src="#" class="img-circle" alt="user image" />
												</div>
												<h4>
													Developers
													<small><i class="fa fa-clock-o"></i> Today</small>
												</h4>
												<p>Why not buy a new awesome theme?</p>
											</a>
										</li>
										<li>
											<a href="#">
												<div class="pull-left">
													<img src="#" class="img-circle" alt="user image" />
												</div>
												<h4>
													Sales Department
													<small><i class="fa fa-clock-o"></i> Yesterday</small>
												</h4>
												<p>Why not buy a new awesome theme?</p>
											</a>
										</li>
										<li>
											<a href="#">
												<div class="pull-left">
													<img src="#" class="img-circle" alt="user image" />
												</div>
												<h4>
													Reviewers
													<small><i class="fa fa-clock-o"></i> 2 days</small>
												</h4>
												<p>Why not buy a new awesome theme?</p>
											</a>
										</li>
									</ul>
								</li>
								<li class="footer"><a href="#">See All Messages</a></li>
							</ul>
						</li>
						<!-- Notifications: style can be found in dropdown.less -->
						<li class="dropdown notifications-menu">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-bell-o"></i>
								<span class="label label-warning" id="notificationCount">0</span>
							</a>
							<ul class="dropdown-menu">
								<li class="header" id="notificationHeader">You have 0 notifications</li>
								<li>
									<!-- inner menu: contains the actual data -->
									<ul class="menu" id="notificationList">
										<!-- Dynamic notifications will be added here -->
									</ul>
								</li>
								<li class="footer"><a href="#">View all</a></li>
							</ul>
						</li>

						<!-- Tasks: style can be found in dropdown.less -->
						<li class="dropdown tasks-menu">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-flag-o"></i>
								<span class="label label-danger">9</span>
							</a>
							<ul class="dropdown-menu">
								<li class="header">You have 9 tasks</li>
								<li>
									<!-- inner menu: contains the actual data -->
									<ul class="menu">
										<li>
											<!-- Task item -->
											<a href="#">
												<h3>
													Design some buttons
													<small class="pull-right">20%</small>
												</h3>
												<div class="progress xs">
													<div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
														<span class="sr-only">20% Complete</span>
													</div>
												</div>
											</a>
										</li><!-- end task item -->
										<li>
											<!-- Task item -->
											<a href="#">
												<h3>
													Create a nice theme
													<small class="pull-right">40%</small>
												</h3>
												<div class="progress xs">
													<div class="progress-bar progress-bar-green" style="width: 40%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
														<span class="sr-only">40% Complete</span>
													</div>
												</div>
											</a>
										</li><!-- end task item -->
										<li>
											<!-- Task item -->
											<a href="#">
												<h3>
													Some task I need to do
													<small class="pull-right">60%</small>
												</h3>
												<div class="progress xs">
													<div class="progress-bar progress-bar-red" style="width: 60%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
														<span class="sr-only">60% Complete</span>
													</div>
												</div>
											</a>
										</li><!-- end task item -->
										<li>
											<!-- Task item -->
											<a href="#">
												<h3>
													Make beautiful transitions
													<small class="pull-right">80%</small>
												</h3>
												<div class="progress xs">
													<div class="progress-bar progress-bar-yellow" style="width: 80%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
														<span class="sr-only">80% Complete</span>
													</div>
												</div>
											</a>
										</li><!-- end task item -->
									</ul>
								</li>
								<li class="footer">
									<a href="#">View all tasks</a>
								</li>
							</ul>
						</li>
						<!-- User Account: style can be found in dropdown.less -->
						<li class="dropdown user user-menu">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<img src="https://ui-avatars.com/api/?name=@(empDetail?.Name)&size=400&background=@colorHexForUrl&color=fff" class="user-image" alt="User Image" />
								<span class="hidden-xs">@(empDetail?.Name)</span>
							</a>
							<ul class="dropdown-menu">
								<!-- User image -->
								<li class="user-header">
									<img src="https://ui-avatars.com/api/?name=@(empDetail?.Name)&size=400&background=@colorHexForUrl&color=fff" class="img-circle" alt="User Image" />
									<p>
										@(empDetail?.Name)
										<small></small>
									</p>
								</li>
								<!-- Menu Body -->
								<li class="user-body">
									<div class="col-xs-4 text-center">
										<a href="#">Followers</a>
									</div>
									<div class="col-xs-4 text-center">
										<a href="#">Sales</a>
									</div>
									<div class="col-xs-4 text-center">
										<a href="#">Friends</a>
									</div>
								</li>
								<!-- Menu Footer-->
								<li class="user-footer">
									<div class="pull-left">
										<a href="#" class="btn btn-default btn-flat">Profile</a>
									</div>
									<div class="pull-right">
										<a href="#" class="btn btn-default btn-flat">Sign out</a>
									</div>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</nav>
		</header>
		<aside class="main-sidebar">
			<!-- sidebar: style can be found in sidebar.less -->
			<section class="sidebar">
				<!-- Sidebar user panel -->
				<div class="user-panel">
					<div class="pull-left image">
						<img src="https://ui-avatars.com/api/?name=@(empDetail?.Name)&size=400&background=@colorHexForUrl&color=fff" class="img-circle" alt="User Image" />
					</div>
					<div class="pull-left info">
						<p>@(empDetail?.Name)</p>

						<a href="#"><i class="fa fa-circle text-success"></i> Online</a>
					</div>
				</div>
				<ul class="sidebar-menu">

					<li>
						<a asp-action="Index" asp-controller="Project">
							<i class="fa fa-th"></i> <span>Projects</span>
						</a>
					<li>
						<a asp-action="Index" asp-controller="ProjectEmployee">
							<i class="fa fa-upload"></i> <span>Project Employee</span>
						</a>
					</li>
					<li>
						<a asp-action="CreateSprint" asp-controller="Sprint">
							<i class="fa fa-list"></i> <span>Sprint</span>
						</a>
					</li>
					<li>
						<a asp-action="Index" asp-controller="ProjectTask">
							<i class="fa fa-list"></i> <span>Project Task</span>
						</a>
					</li>

					<li class="treeview">
						<a href="#">
							<i class="fa fa-users"></i> <span>User Management</span>
							<i class="fa fa-angle-left pull-right"></i>
						</a>
						<ul class="treeview-menu">
							<li><a asp-action="CreateRole" asp-controller="Master"><i class="fa fa-user-shield"></i> Roles</a></li>
							<li><a asp-action="CreateDepartment" asp-controller="Master"><i class="fa fa-sitemap"></i> Departments</a></li>
							<li><a asp-action="CreateDesignation" asp-controller="Master"><i class="fa fa-user-tie"></i> Designations</a></li>
							<li><a asp-action="CreateTask" asp-controller="Master"><i class="fa fa-check-circle"></i> Task Status</a></li>
							<li><a asp-action="CreateEmployee" asp-controller="UserManagement"><i class="fa fa-check-circle"></i> Employees</a></li>
							<li><a asp-action="CreateUser" asp-controller="UserManagement"><i class="fa fa-check-circle"></i> Users</a></li>
						</ul>
					</li>

				</ul>
			</section>
			<!-- /.sidebar -->
		</aside>

		<div id="loader-overlay">
			<div class="loader-content text-center">
				<div class="spinner mb-3"></div>
				<div id="loader-percentage" class="text-light fw-bold fs-5">0%</div>
			</div>
		</div>

		@RenderBody()

		@RenderSection("Scripts", required: false)

		<footer class="main-footer">
			<div class="pull-right hidden-xs">
				<b>Version</b> 2.0
			</div>
			<strong>Copyright &copy; 2024-2025 <a href="http://VipraInfotech.com">Vipra InfoTech</a>.</strong> All rights reserved.
		</footer>

	</div>

	<!-- jQuery FIRST -->
	<!-- jQuery FIRST -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- Bootstrap depends on jQuery -->
	<script src="~/bootstrap/js/bootstrap.min.js"></script>

	<!-- AdminLTE core -->
	<script src="~/dist/js/app.min.js"></script>

	<!-- DataTables depends on jQuery -->
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<!-- Your custom scripts should come LAST -->
	<script src="~/pmsjs/custom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
	<script>
		const connection = new signalR.HubConnectionBuilder()
			.withUrl("/notificationHub")
			.build();

		// 🔔 Status Changed
		connection.on("ReceiveProjectStatusUpdate", function (projectId, newStatus) {
			showNotification(`Project #${projectId} status changed to: ${newStatus}`, 'fa-tasks', 'text-blue');
		});

		// 🆕 Project Created
		connection.on("ProjectCreated", function (projectId, name) {
			showNotification(`New project created: ${name} (#${projectId})`, 'fa-plus', 'text-green');
		});

		connection.on("DiscussionAdded", function (TaskName, AddedBy) {
			showNotification(`New Comment has been added for Task: ${TaskName} Added By  (#${AddedBy})`, 'fa-plus', 'text-green');
		});

		// ⚠️ Project Deleted
		connection.on("ProjectDeleted", function (projectId) {
			showNotification(`Project #${projectId} has been deleted.`, 'fa-trash', 'text-red');
		});

		// Shared function to add to bell dropdown
		function showNotification(message, icon, color) {
			const itemHtml = `
				<li>
					<a href="#">
						<i class="fa ${icon} ${color}"></i> ${message}
					</a>
				</li>`;

			$('#notificationList').prepend(itemHtml);

			// Update count
			let count = parseInt($('#notificationCount').text()) || 0;
			count++;
			$('#notificationCount').text(count);
			$('#notificationHeader').text(`You have ${count} notification${count !== 1 ? 's' : ''}`);
		}

		connection.start().catch(function (err) {
			console.error(err.toString());
		});

	</script>


</body>

<script>
	// Backup original
	const originalWarn = console.warn;

	// Override and filter specific warning
	console.warn = function (message, ...args) {
		if (typeof message === 'string' && message.includes('CKEditor')) {
			return; // suppress
		}
		originalWarn.apply(console, [message, ...args]);
	};
</script>
</html>
